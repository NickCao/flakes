From 68aca45d3c4c49bfdb4139adf2ce562a8e66eccc Mon Sep 17 00:00:00 2001
From: Nick Cao <nickcao@nichi.co>
Date: Sun, 6 Aug 2023 16:11:38 +0800
Subject: [PATCH] sftp: raise packet size and concurrency

---
 internal/backend/sftp/sftp.go | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/internal/backend/sftp/sftp.go b/internal/backend/sftp/sftp.go
index 3e127ef05..6cca14528 100644
--- a/internal/backend/sftp/sftp.go
+++ b/internal/backend/sftp/sftp.go
@@ -102,7 +102,10 @@ func startClient(cfg Config) (*SFTP, error) {
 	}()
 
 	// open the SFTP session
-	client, err := sftp.NewClientPipe(rd, wr)
+	client, err := sftp.NewClientPipe(rd, wr,
+		sftp.MaxConcurrentRequestsPerFile(256),
+		sftp.MaxPacketUnchecked(261120),
+	)
 	if err != nil {
 		return nil, errors.Errorf("unable to start the sftp session, error: %v", err)
 	}
-- 
2.41.0

